<!DOCTYPE html>
<!--解决idea thymeleaf 表达式模板报红波浪线-->
<!--suppress ALL -->
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>srpingboot</title>
    <link rel="stylesheet" type="text/css" href="lib/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="lib/bootstrap/css/pagination.css">
    <link rel="stylesheet" type="text/css" href="lib/bootstrap/css/jquery.dataTables.min.css">


    <style>
        table{
            width:100%;
            border-collapse: collapse;
        }
        table td{
            height:35px;
            line-height: 35px;
            text-align: center;
            border:1px solid #ddd;
        }
        table th {
            height:40px;
            line-height: 40px;
            text-align: center;
            border:1px solid #ddd;
            background:#d3d1d2;
        }
        table tr:nth-child(odd){
            background:#fff;
        }
        table tr:nth-child(even){
            background:#ddd;
        }
        table tr:hover{
            background:#007bff;
        }
        .inputStyle{
            width:120px;
            height:35px;
            padding:3px;
        }
        .inputrightStyle{
            width:300px;
            height:35px;
            padding:3px;
        }
        .btn{
            padding:5px 20px;
            text-align: center;
            margin-right:5px;
            background:#ddd;
        }
        .link{
            color:#80bdff;
            cursor: pointer;
        }.page-container {
             margin: 20px 0;
         }

        .card {
            margin-bottom: 15px;
        }

        .page-option-btn {
            margin-right: 10px;
        }
    </style>
</head>
<body>
<!-- 属性替换，其他属性同理 -->
<h1 th:text="${newText}">Hello World</h1>
<!--
    设置多个attr
    th:attr="id=${user.id},data-xxx=${user.xxx},data-yyy=${user.yyy}"

    片段的使用、传值和调用
    <div th:fragment="common(text1,text2)">
        ...
    </div>
    th:insert 是最简单的：它只是插入指定的片段作为其主机标签的主体。
    <div th:insert="base ::common(${text1},${text2})"></div>

    th:replace实际上用指定的片段替换它的主机标签。
    <div th:replace="base ::common(${text1},${text2})"></div>　　　　　　　　　三目表达式：　　　　　<h3 th:text="${loginUser != null} ? ${loginUser.username} : '请登录'"></h3>　
-->

<!-- if-else --><!--
<h3 th:if="${loginUser} ne null" th:text="${loginUser.username}"></h3>
<h3 th:unless="${loginUser} ne null">请登录</h3>

&lt;!&ndash; switch &ndash;&gt;
<div th:switch="${gender}">
    <p th:case="'1'">男</p>
    <p th:case="'0'">女</p>
    &lt;!&ndash; th:case="*"  类似switch中的default &ndash;&gt;
    <p th:case="*">其他</p>
</div>-->
<div style="text-align: center;padding:15px;margin-bottom:30px;">
    <div style="width:48%;float:left;border:1px solid #333;text-align: center;padding:15px;margin-bottom:30px;">
        名称&nbsp;<input class="inputStyle" id="queryPartId">
        名称&nbsp;<input class="inputStyle" id="queryPartId">
        名称&nbsp;<input class="inputStyle" id="queryPartId">
        名称&nbsp;<input class="inputStyle" id="queryPartId">
        <p style="text-align: center;margin-top:20px;">
            <button class="btn" onclick="queryInit()">查询</button>
            <button class="btn" onclick="addInit()">新增</button>
        </p>
    </div>
    <div style="width:48%;float:right;border:1px solid #333;text-align: center;padding:15px;margin-bottom:30px;">
        名称&nbsp;<input class="inputrightStyle" id="queryPartId">
        <p style="text-align: center;margin-top:20px;">
            <button class="btn" onclick="queryInit()">查询</button>
            <button class="btn" onclick="addInit()">新增</button>
        </p>
    </div>


</div>
<!-- 　　　　each　　　　其中，iterStat参数为状态变量，常用的属性有　　　　index 迭代下标，从0开始　　　　count 迭代下标，从1开始　　　　size 迭代元素的总量　　　　current 当前元素
　　 -->
<table class="tablelist" id="example">
    <thead>
    <tr>
        <th>捆包号</th>
        <th>规格</th>
        <th>件数</th>
        <th>包装工艺</th>
        <th>牌号</th>
        <th>零件号</th>
        <th>操作</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="product,iterStat : ${pager.list}">
        <td th:text="${product.packId}"></td>
        <td th:text="${product.spec}"></td>
        <td th:text="${product.quantity}"></td>
        <td th:text="${product.productTypeid}"></td>
        <td th:text="${product.shopsign}"></td>
        <td th:text="${product.partId}"></td>
        <td>
            <a class="link" th:data-id="${product.partId}"  onclick="updateInit(this.getAttribute('data-id'))" >修改</a>
            <!--<a class="link">删除</a>-->


        </td>
    </tr>
    </tbody>
</table>






























<ul th:if="${pager.list} != null" class="pagination pagination-sm">
    <li th:class="${pager.pageNum == 1}?'disabled':''">
        <a th:if="${pager.pageNum != 1}" th:href="@{'/list?pageNo='+${pager.pageNum-1}}">上一页</a>
        <a th:if="${pager.pageNum == 1}" href="#">上一页</a>
    </li>

    <li ><a th:if="${pager.pageNum-4 >= 1 && pager.pageNum == pager.pages}" th:href="@{'/list?pageNo='+${pager.pageNum-4}}">[[${pager.pageNum-4}]]</a></li>
    <li ><a th:if="${pager.pageNum-3 >= 1 && pager.pages-pager.pageNum <= 1 }" th:href="@{'/list?pageNo='+${pager.pageNum-3}}">[[${pager.pageNum-3}]]</a></li>

    <li ><a th:if="${pager.pageNum-2 >= 1}" th:href="@{'/list?pageNo='+${pager.pageNum-2}}">[[${pager.pageNum-2}]]</a></li>
    <li ><a th:if="${pager.pageNum-1 >= 1}" th:href="@{'/list?pageNo='+${pager.pageNum-1}}">[[${pager.pageNum-1}]]</a></li>
    <li class="list"><a href="#" th:text="${pager.pageNum}">[[${pager.pageNum}]]</a></li>
    <li ><a th:if="${pager.pageNum+1 <= pager.pages}" th:href="@{'/list?pageNo='+${pager.pageNum+1}}">[[${pager.pageNum+1}]]</a></li>
    <li ><a th:if="${pager.pageNum+2 <= pager.pages}" th:href="@{'/list?pageNo='+${pager.pageNum+2}}">[[${pager.pageNum+2}]]</a></li>
    <li ><a th:if="${pager.pageNum+3 <= pager.pages && pager.pageNum < 3}" th:href="@{'/list?pageNo='+${pager.pageNum+3}}">[[${pager.pageNum+3}]]</a></li>
    <li ><a th:if="${pager.pageNum+4 <= pager.pages && pager.pageNum < 2}" th:href="@{'/list?pageNo='+${pager.pageNum+4}}">[[${pager.pageNum+4}]]</a></li>

    <li th:class="${pager.pageNum == pager.pages}?'disabled':''">
        <a th:if="${pager.pageNum != pager.pages}"  th:href="@{'/list?pageNo='+${pager.pageNum+1}}">下一页</a>
        <a th:if="${pager.pageNum == pager.pages}"  href="#">下一页</a>
    </li>
</ul>
<div class="row">
    <div class="page-container" style="margin:20px auto;">

    </div>
</div>




<div class="modal fade bs-example-modal-lg" id="newAddModal">
    <div class="modal-dialog modal-lg">
        <div class="modal-content" >
            <div class="modal-header" >
                <h4 class="modal-title">新增</h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-4">
                        <div class="input-group">
                            <span class="input-group-text" >姓名</span>
                            <input type="text" class="form-control" aria-describedby="name1" id="partId1" >
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="input-group">
                            <span class="input-group-text" >姓名</span>
                            <input type="text" class="form-control" aria-describedby="name1" id="spec1">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="input-group">
                            <span class="input-group-text" id="quantity">姓名</span>
                            <input type="text" class="form-control" aria-describedby="name1">
                        </div>
                    </div>

                </div>
            </div>
            <div class="modal-footer">
                <button data-dismiss="modal" type="button" class="btn-primary" href="javascript:void(0)" onclick="insertProduct()">确定</button>
                <button data-dismiss="modal" type="button" class="btn-default">取消</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade bs-example-modal-lg" id="updateModal">
    <div class="modal-dialog modal-lg">
        <div class="modal-content" >
            <div class="modal-header" >
                <h4 class="modal-title">修改</h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-4">
                        <div class="input-group">
                            <span class="input-group-text" >捆包号</span>
                            <input type="text" class="form-control" aria-describedby="name1" id="packId" >
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="input-group">
                            <span class="input-group-text" >规格</span>
                            <input type="text" class="form-control" aria-describedby="name1" id="spec">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="input-group">
                            <span class="input-group-text" id="quantity">件数</span>
                            <input type="text" class="form-control" aria-describedby="name1">
                        </div>
                    </div>

                </div>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-4">
                        <div class="input-group">
                            <span class="input-group-text" >捆包号</span>
                            <input type="text" class="form-control" aria-describedby="name1" id="packIdd" >
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="input-group">
                            <span class="input-group-text" >规格</span>
                            <input type="text" class="form-control" aria-describedby="name1" id="specs">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="input-group">
                            <span class="input-group-text" id="quantity">件数</span>
                            <input type="text" class="form-control" aria-describedby="name1">
                        </div>
                    </div>

                </div>
            </div>
            <div class="modal-footer">
                <button data-dismiss="modal" type="button" class="btn-primary" href="javascript:void(0)" onclick="updateProduct('${product.partId}')">修改</button>
                <button data-dismiss="modal" type="button" class="btn-default">取消</button>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript" src="lib/jquery/jquery-3.5.1.min.js"></script>
<script type="text/javascript" src="lib/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="lib/bootstrap/js/pagination.js"></script>

<script type="text/javascript" src="lib/bootstrap/js/jquery.dataTables.min.js"></script>
<script>

</script>
<script type="text/javascript" >


    function queryInit() {

        var queryPartId  = $("#queryPartId").val();


        window.location.href="/list?partId="+queryPartId

    }

    function  del(id) {
        alert(id);
    }
    function addInit() {
        $('#newAddModal').modal('show');
    }

    function updateInit(id) {
        console.log(id);
        // var partId = $("#partId").val();
        $('#updateModal').modal('show');
        $.ajax({
            url: '/queryInfo',
            data : {"id":id},
            dataType: "json",
            success:function (result) {
                if (result != null && result.length > 0){
                    for (var i=0;i<result.length;i++){
                        $('#partId').val(result[i].partId);
                        $('#spec').val(result[i].spec);

                    }
                }
                    }
        });

    }

    function insertProduct() {
        var partId = $("#partId").val();    // 获取id为username的<input>框数据
        var spec = $("#spec").val();    // 获取id为password的<input>框数据
        $.ajax({
            url: '/insertInfo',
            data : {"partId":partId, "spec":spec},
            dataType: "json",
            success:function (result) {
                if (result.eq("200")){
                    alert("修改成功！")
                }
            }
        });
    }
    
    function updateProduct() {

        var partId = $("#partId").val();    // 获取id为username的<input>框数据
        var spec = $("#spec").val();    // 获取id为password的<input>框数据
        $.ajax({
            url: '/updateInfo',
            data : {"partId":partId, "spec":spec},
            dataType: "json",
            success:function (result) {
                console.log(result);
                if (result =="200"){
                    /*var back = confirm('是否继续操作');
                    if(back){
                        console.log(11);
                    }else{
                        console.log(2)
                    }*/
                    alert("修改成功！");
                    /*location.href = "/list";*/
                    window.location.reload();

                }
            }
        });
    }
    var size=[[${pager.total}]];
    const pageSize = [[${pager.pageSize}]];
    const dataCount = [[${pager.total}]];
    const pager = new Pagination('.page-container', {
        pageSize: pageSize,
        autoLoad: true,
        unit: '条',
        toPage: function (index, _pageSize) {
            // 设置记录总数，用于生成分页HTML内容
            if (index === 0 || _pageSize) this.updateCount(dataCount, _pageSize)

            // 根据页码以及分页大小生成html内容
            let pageListHtml = ''
            for (var i = 0; i < (_pageSize || pageSize); i++) {
                pageListHtml += `
            <div class="col-md-3">
              <div class="card">
                <div class="card-body">
                  <h5 class="card-title">Card - ${index * (_pageSize || pageSize) + i + 1}</h5>
                  <p class="card-text">card-text,card-text,card-text,card-text</p>
                </div>
              </div>
            </div>
          `
            }
            $('.page-list').html(pageListHtml)
        }
    })

    $("#btn_first_page").click((el) => {
        pager.handleToPage(0)
        setBtnDisabled()
    })
    $("#btn_pre_page").click(() => {
        pager.handleToPage(pager.pageIndex - 1)
        setBtnDisabled()
    })
    $("#btn_next_page").click(() => {
        pager.handleToPage(pager.pageIndex + 1)
        setBtnDisabled()
    })
    $("#btn_last_page").click(() => {
        pager.handleToPage(pager.pageCount - 1)
        setBtnDisabled()
    })
    $("#btn_jump_page").click(() => {
        pager.handleToPage(4)
        setBtnDisabled()
    })

    function setBtnDisabled() {
        $(".page-option-btn").removeClass("disabled")
        if (pager.pageIndex === 0) {
            $(".page-option-btn:nth(1)").addClass("disabled")
        }

        if (pager.pageIndex === pager.pageCount - 1) {
            $(".page-option-btn:nth(2)").addClass("disabled")
        }
    }



</script>

<script type="text/javascript">
    $(document).ready(function(){
        $("#example").dataTable({
            "bProcessing" : true, //DataTables载入数据时，是否显示‘进度’提示
            "aLengthMenu" : [5, 10, 15], //更改显示记录数选项
            "sPaginationType" : "full_numbers", //详细分页组，可以支持直接跳转到某页
            "bAutoWidth" : true, //是否自适应宽度
            //"bJQueryUI" : true,
            "oLanguage": { //国际化配置
                "sProcessing" : "正在获取数据，请稍后...",
                "sLengthMenu" : "显示 _MENU_ 条",
                "sZeroRecords" : "没有您要搜索的内容",
                "sInfo" : "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
                "sInfoEmpty" : "记录数为0",
                "sInfoFiltered" : "(全部记录数 _MAX_ 条)",
                "sInfoPostFix" : "",
                "sSearch" : "搜索",
                "sUrl" : "",
                "oPaginate": {
                    "sFirst" : "第一页",
                    "sPrevious" : "上一页",
                    "sNext" : "下一页",
                    "sLast" : "最后一页"
                }
            },
        });
    });
</script>
</body>

</html>